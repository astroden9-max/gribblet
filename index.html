<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advertise with Us</title>
<style>
html, body {
  margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden;
}
iframe {
  width: 100%; height: 100%; border: none;
}
</style>
</head>
<body>

<iframe id="ad-frame" src=""></iframe>

<script>
const iframe = document.getElementById('ad-frame');
const reviveAdUrl = "reviveads.html";
const sponsorPageUrl = "sponsourpage.html";
const maxWait = 5000; // 5 seconds maximum wait time
let timeoutId; // Variable to hold the timer ID, accessible by all functions

// 1. Define the message handler function
const handleMessage = function(event) {
  // Check for the specific success signal from the iframe
  if (event.data === 'ad-loaded-success') {
    console.log("SUCCESS SIGNAL RECEIVED. Clearing fallback timer.");
    
    // Cancel the pending fallback
    if (timeoutId) {
      clearTimeout(timeoutId); 
    }
    
    // Clean up the listener since the ad is showing
    window.removeEventListener('message', handleMessage); 
    
    // The iframe is now showing the ad and will NOT switch to the sponsor page.
  }
};

// 2. Start listening for the success signal
window.addEventListener('message', handleMessage);

// 3. Set up the Fallback Timeout
timeoutId = setTimeout(() => {
  console.log("Ad failed to load or success signal not received within 5s. Falling back to sponsor page.");
  window.removeEventListener('message', handleMessage); // Stop listening
  
  // Only switch the source if the success signal didn't already cancel this timer
  if (iframe.src.includes(reviveAdUrl)) {
      iframe.src = sponsorPageUrl;
  }
}, maxWait);


// 4. Start with the Ad Page
iframe.src = reviveAdUrl;

// Optional: Add an error handler for the iframe itself failing to load
iframe.onerror = function() {
    console.error("Error loading reviveads.html file itself. Immediately falling back.");
    if (timeoutId) {
      clearTimeout(timeoutId);
    }
    window.removeEventListener('message', handleMessage);
    iframe.src = sponsorPageUrl;
};
</script>

</body>
</html>